{% extends "base.html" %}
{% block content %}

<div class="min-h-screen bg-gray-900 text-gray-100 p-6">

  <h1 class="text-4xl font-bold mb-8">ðŸ“Š Dashboard</h1>

  <!-- Stat Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-10">
    <div class="bg-gradient-to-r from-blue-500 to-blue-700 rounded-xl p-6 shadow-lg hover:scale-105 transition-transform">
      <h3 class="text-2xl font-bold">{{ total_albums }}</h3>
      <p>Albums</p>
    </div>
    <div class="bg-gradient-to-r from-green-500 to-green-700 rounded-xl p-6 shadow-lg hover:scale-105 transition-transform">
      <h3 class="text-2xl font-bold">{{ total_artists }}</h3>
      <p>Artists</p>
    </div>
    <div class="bg-gradient-to-r from-yellow-500 to-yellow-700 rounded-xl p-6 shadow-lg hover:scale-105 transition-transform">
      <h3 class="text-2xl font-bold">{{ total_genres }}</h3>
      <p>Genres</p>
    </div>
    <div class="bg-gradient-to-r from-red-500 to-red-700 rounded-xl p-6 shadow-lg hover:scale-105 transition-transform">
      <h3 class="text-2xl font-bold">{{ total_plays }}</h3>
      <p>Plays</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="grid md:grid-cols-2 gap-6 mb-10">
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
      <h2 class="text-xl font-bold mb-4">Albums per Genre</h2>
      <div id="genreChart"></div>
    </div>
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
      <h2 class="text-xl font-bold mb-4">Albums per Year</h2>
      <div id="yearChart"></div>
    </div>
  </div>

  <!-- Recent Albums Table -->
  <div class="bg-gray-800 p-6 rounded-xl shadow-lg overflow-x-auto">
    <h2 class="text-xl font-bold mb-4">Recent Albums</h2>
    <table class="min-w-full table-auto text-gray-100">
      <thead>
        <tr class="bg-gray-700">
          <th class="px-4 py-2 text-left">Title</th>
          <th class="px-4 py-2 text-left">Year</th>
          <th class="px-4 py-2 text-left">Genre</th>
          <th class="px-4 py-2 text-left">Artists</th>
        </tr>
      </thead>
      <tbody>
        {% for a in albums %}
        <tr class="border-b border-gray-700 hover:bg-gray-700">
          <td class="px-4 py-2">{{ a[1] }}</td>
          <td class="px-4 py-2">{{ a[3] }}</td>
          <td class="px-4 py-2">{{ a[5] }}</td>
          <td class="px-4 py-2">{{ a[6] }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- ApexCharts -->
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
  const genreLabels = {{ genre_data | map(attribute='label') | list | tojson }};
  const genreCounts = {{ genre_data | map(attribute='count') | list | tojson }};
  const yearLabels = {{ year_data | map(attribute='label') | list | tojson }};
  const yearCounts = {{ year_data | map(attribute='count') | list | tojson }};

  // Genre Bar Chart
  new ApexCharts(document.querySelector("#genreChart"), {
    chart: { type: 'bar', height: 350 },
    series: [{ name: 'Albums', data: genreCounts }],
    xaxis: { categories: genreLabels },
    theme: { mode: 'dark' },
    colors: ['#3B82F6']
  }).render();

  // Year Line Chart
  new ApexCharts(document.querySelector("#yearChart"), {
    chart: { type: 'line', height: 350 },
    series: [{ name: 'Albums', data: yearCounts }],
    xaxis: { categories: yearLabels },
    stroke: { curve: 'smooth' },
    theme: { mode: 'dark' },
    colors: ['#F59E0B']
  }).render();
</script>

{% endblock %}
