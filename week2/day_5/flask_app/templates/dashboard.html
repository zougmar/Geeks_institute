{% extends "base.html" %}
{% block content %}

<h1 class="text-4xl font-extrabold mb-8 text-gray-900">ðŸ“Š Dashboard</h1>

<!-- STAT CARDS -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 mb-10">
  <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-smooth">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 font-medium">Total Albums</p>
        <p class="text-2xl font-bold text-gray-900">{{ total_albums }}</p>
      </div>
      <i class="bi bi-music-note-beamed text-3xl text-blue-500"></i>
    </div>
  </div>

  <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-smooth">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 font-medium">Total Artists</p>
        <p class="text-2xl font-bold text-gray-900">{{ total_artists }}</p>
      </div>
      <i class="bi bi-people-fill text-3xl text-green-500"></i>
    </div>
  </div>

  <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-smooth">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 font-medium">Total Genres</p>
        <p class="text-2xl font-bold text-gray-900">{{ total_genres }}</p>
      </div>
      <i class="bi bi-tags-fill text-3xl text-yellow-500"></i>
    </div>
  </div>

  <div class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-smooth">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-500 font-medium">Total Plays</p>
        <p class="text-2xl font-bold text-gray-900">{{ total_plays }}</p>
      </div>
      <i class="bi bi-play-fill text-3xl text-red-500"></i>
    </div>
  </div>
</div>

<!-- ALBUMS TABLE -->
<div class="bg-white rounded-xl shadow p-6 mb-10">
  <h2 class="text-xl font-bold text-gray-900 mb-4">Recent Albums</h2>
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Genre</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Artists</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for a in albums %}
        <tr class="hover:bg-gray-50 transition-smooth">
          <td class="px-6 py-4 whitespace-nowrap">{{ a[1] }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ a[3] }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ a[5] }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ a[6] }}</td>
          <td class="px-6 py-4 whitespace-nowrap flex gap-2">
            <a href="/edit/{{ a[0] }}" class="px-3 py-1 rounded-full bg-green-600 text-white hover:bg-green-700 transition-smooth text-sm">Edit</a>
            <form action="/delete/{{ a[0] }}" method="post" onsubmit="return confirm('Are you sure?');">
              <button type="submit" class="px-3 py-1 rounded-full bg-red-600 text-white hover:bg-red-700 transition-smooth text-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- CHARTS -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <div class="bg-white p-6 rounded-xl shadow">
    <h2 class="text-xl font-bold mb-4 text-gray-900">Albums per Genre</h2>
    <canvas id="genreChart"></canvas>
  </div>

  <div class="bg-white p-6 rounded-xl shadow">
    <h2 class="text-xl font-bold mb-4 text-gray-900">Albums per Year</h2>
    <canvas id="yearChart"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const genreLabels = {{ genre_data | map(attribute=0) | list | tojson }};
  const genreCounts = {{ genre_data | map(attribute=1) | list | tojson }};

  const yearLabels = {{ year_data | map(attribute=0) | list | tojson }};
  const yearCounts = {{ year_data | map(attribute=1) | list | tojson }};

  new Chart(document.getElementById('genreChart'), {
      type: 'bar',
      data: { labels: genreLabels, datasets: [{ label: 'Albums', data: genreCounts, backgroundColor: 'rgba(59, 130, 246, 0.7)' }] },
      options: { responsive: true, plugins: { legend: { display: false } } }
  });

  new Chart(document.getElementById('yearChart'), {
      type: 'line',
      data: { labels: yearLabels, datasets: [{ label: 'Albums', data: yearCounts, borderColor: 'rgba(234, 179, 8, 0.9)', backgroundColor: 'rgba(234, 179, 8, 0.4)', fill: true, tension: 0.3 }] },
      options: { responsive: true, plugins: { legend: { display: false } } }
  });
</script>

{% endblock %}
